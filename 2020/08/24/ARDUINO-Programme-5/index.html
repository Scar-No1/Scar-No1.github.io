<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="This is the last project of this program. I made a draw board.   This program was divided into two classes.  First classIn this class, I mainly focused on the installation of basic components. It cons">
<meta property="og:type" content="article">
<meta property="og:title" content="ARDUINO Programme 5">
<meta property="og:url" content="http://example.com/2020/08/24/ARDUINO-Programme-5/index.html">
<meta property="og:site_name" content="Han&#39;s blog">
<meta property="og:description" content="This is the last project of this program. I made a draw board.   This program was divided into two classes.  First classIn this class, I mainly focused on the installation of basic components. It cons">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1.ax1x.com/2020/08/29/d74les.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/08/29/d7LK6P.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/08/29/d7vyb6.jpg">
<meta property="article:published_time" content="2020-08-24T09:19:00.000Z">
<meta property="article:modified_time" content="2020-08-29T09:38:07.982Z">
<meta property="article:author" content="Han">
<meta property="article:tag" content="Academic Rcording">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2020/08/29/d74les.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/2020/08/24/ARDUINO-Programme-5/"/>





  <title>ARDUINO Programme 5 | Han's blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Han's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Daily Rcording</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/24/ARDUINO-Programme-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Han's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ARDUINO Programme 5</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-24T17:19:00+08:00">
                2020-08-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>This is the last project of this program. I made a draw board.  </p>
<p>This program was divided into two classes. </p>
<h3 id="First-class"><a href="#First-class" class="headerlink" title="First class"></a>First class</h3><p>In this class, I mainly focused on the installation of basic components. It consists of  the base, the mechanical arm, the white board and the pen. </p>
<p><img src="https://s1.ax1x.com/2020/08/29/d74les.png" alt="d74les.png"></p>
<p>The main driving device is the mechanical arm. Three servos made the arm move in different direction. One of the servos is in charge of lifting and setting pens. The other two are responsible for writing on a horizontal plane.</p>
<p>There is also a eraser which is placed in a corner of the board. The mechanical arm can use it to erase the board automatically every time before writing.</p>
<h3 id="Second-class"><a href="#Second-class" class="headerlink" title="Second class"></a>Second class</h3><p>In the second class, we began to write the code and adjust the parameter.</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/d7LK6P"><img src="https://s1.ax1x.com/2020/08/29/d7LK6P.png" alt="d7LK6P.png"></a></p>
<p>These are the important parameters I needed to adjust. These includes the degree how the mechanical arm will lift and set when writing, the exact coordinate of the eraser and the range of the arm can move.</p>
<p>These parameters need to be very exact that takes me hours to adjust them.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br></pre></td><td class="code"><pre><span class="line">#define SERVOPINLIFT  <span class="number">2</span> <span class="comment">//抬臂舵机</span></span><br><span class="line">#define SERVOPINLEFT  <span class="number">3</span> <span class="comment">//左臂舵机</span></span><br><span class="line">#define SERVOPINRIGHT <span class="number">4</span> <span class="comment">//右臂舵机</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 速度  数字越小越慢，太快了容易抖 1000~2000</span></span><br><span class="line">#define LIFTSPEED <span class="number">1500</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 悬臂的长度，根据图纸测量，无需改变</span></span><br><span class="line">#define L1 <span class="number">35</span></span><br><span class="line">#define L2 <span class="number">57.2</span></span><br><span class="line">#define L3 <span class="number">14.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 左右舵机轴心的位置，根据图纸测量，无需改变</span></span><br><span class="line">#define O1X <span class="number">22</span></span><br><span class="line">#define O1Y -<span class="number">25</span></span><br><span class="line">#define O2X <span class="number">47</span></span><br><span class="line">#define O2Y -<span class="number">25</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//需要的库函数 ,如果编译报告 time.h 错误请参考readme文档、</span></span><br><span class="line"><span class="comment">//#include &lt;Time.h&gt; // see http://playground.arduino.cc/Code/time </span></span><br><span class="line">#include &lt;Servo.h&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> servoLift = LIFT2;</span><br><span class="line"></span><br><span class="line">Servo servo1;  <span class="comment">// </span></span><br><span class="line">Servo servo2;  <span class="comment">// </span></span><br><span class="line">Servo servo3;  <span class="comment">// </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">double</span> lastX = rubberx;</span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">double</span> lastY = rubbery;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> last_min = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">  <span class="comment">// 设置一个模拟时间，（小时，分钟，后面全填0）</span></span><br><span class="line">  <span class="comment">//如果此句编译错误，请将文件包内的libraries库放到Arduino文件夹内，具体操作办法见说明文档</span></span><br><span class="line">  servo1.attach(SERVOPINLIFT);  <span class="comment">//初始化抬臂舵机  lifting servo</span></span><br><span class="line">  servo2.attach(SERVOPINLEFT);  <span class="comment">//初始化左臂舵机  left servo</span></span><br><span class="line">  servo3.attach(SERVOPINRIGHT); <span class="comment">//初始化右臂舵机  right servo</span></span><br><span class="line">  lift(<span class="number">2</span>); <span class="comment">//高抬笔</span></span><br><span class="line">  drawTo(rubberx, rubbery); <span class="comment">//停留在笔擦位置</span></span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">      lift(<span class="number">0</span>); <span class="comment">//落笔写字 </span></span><br><span class="line">      number(<span class="number">0</span>, <span class="number">3</span>, <span class="number">111</span>, <span class="number">1</span>);   <span class="comment">// 檫黑板  </span></span><br><span class="line">      number(<span class="number">0</span>, <span class="number">25</span>, <span class="number">1</span>, <span class="number">1</span>); </span><br><span class="line">      number(<span class="number">14</span>, <span class="number">25</span>, <span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">      number(<span class="number">25</span>, <span class="number">25</span>, <span class="number">11</span>,<span class="number">1</span>);  <span class="comment">// 打点</span></span><br><span class="line">      number(<span class="number">32</span>, <span class="number">25</span>, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">      number(<span class="number">43</span>, <span class="number">25</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      lift(<span class="number">2</span>); <span class="comment">//高抬笔</span></span><br><span class="line">      drawTo(rubberx, rubbery); <span class="comment">//【此数值可能需要调节】  默认为70  44</span></span><br><span class="line">      lift(<span class="number">1</span>);<span class="comment">//抬笔</span></span><br><span class="line">      servo1.detach();</span><br><span class="line">      servo2.detach();</span><br><span class="line">      servo3.detach();</span><br><span class="line">     <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// Writing numeral with bx by being the bottom left originpoint. Scale 1 equals a 20 mm high font.</span></span><br><span class="line"><span class="comment">// The structure follows this principle: move to first startpoint of the numeral, lift down, draw numeral, lift up</span></span><br><span class="line"><span class="comment">//这里是写字的函数，如果你觉得字写的丑，可以自行修改字体，结果可能是更丑</span></span><br><span class="line"><span class="comment">//还可以自行增加其他内容，比如字母甚至是汉字</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">number</span><span class="params">(<span class="keyword">float</span> bx, <span class="keyword">float</span> by, <span class="keyword">int</span> num, <span class="keyword">float</span> scale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (num) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    drawTo(bx + <span class="number">12</span> * scale, by + <span class="number">6</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenGZS(bx + <span class="number">7</span> * scale, by + <span class="number">10</span> * scale, <span class="number">10</span> * scale, -<span class="number">0.8</span>, <span class="number">6.7</span>, <span class="number">0.5</span>);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">    drawTo(bx + <span class="number">3</span> * scale, by + <span class="number">15</span> * scale); <span class="comment">//</span></span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    drawTo(bx + <span class="number">5</span> * scale, by + <span class="number">20</span> * scale);<span class="comment">// drawTo(bx + 10 * scale, by + 20 * scale);</span></span><br><span class="line">    drawTo(bx + <span class="number">5</span> * scale, by + <span class="number">0</span> * scale);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    drawTo(bx + <span class="number">2</span> * scale, by + <span class="number">12</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenUZS(bx + <span class="number">8</span> * scale, by + <span class="number">14</span> * scale, <span class="number">6</span> * scale, <span class="number">3</span>, -<span class="number">0.8</span>, <span class="number">1</span>);</span><br><span class="line">    drawTo(bx + <span class="number">1</span> * scale, by + <span class="number">0</span> * scale);</span><br><span class="line">    drawTo(bx + <span class="number">12</span> * scale, by + <span class="number">2</span> * scale);<span class="comment">//    drawTo(bx + 12 * scale, by + 0 * scale);</span></span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    drawTo(bx + <span class="number">2</span> * scale, by + <span class="number">17</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenUZS(bx + <span class="number">5</span> * scale, by + <span class="number">15</span> * scale, <span class="number">5</span> * scale, <span class="number">3</span>, -<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    bogenUZS(bx + <span class="number">5</span> * scale, by + <span class="number">5</span> * scale, <span class="number">5</span> * scale, <span class="number">1.57</span>, -<span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">    drawTo(bx + <span class="number">10</span> * scale, by + <span class="number">0</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    drawTo(bx + <span class="number">10</span> * scale, by + <span class="number">20</span> * scale);</span><br><span class="line">    drawTo(bx + <span class="number">4</span> * scale, by + <span class="number">2</span> * scale); <span class="comment">//   drawTo(bx + 2 * scale, by + 6 * scale);</span></span><br><span class="line">    drawTo(bx + <span class="number">15</span> * scale, by + <span class="number">6</span> * scale);<span class="comment">//    drawTo(bx + 12 * scale, by + 6 * scale);</span></span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">    drawTo(bx + <span class="number">2</span> * scale, by + <span class="number">5</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenGZS(bx + <span class="number">5</span> * scale, by + <span class="number">6</span> * scale, <span class="number">6</span> * scale, -<span class="number">2.5</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    drawTo(bx + <span class="number">5</span> * scale, by + <span class="number">20</span> * scale);</span><br><span class="line">    drawTo(bx + <span class="number">12</span> * scale, by + <span class="number">20</span> * scale);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">    drawTo(bx + <span class="number">2</span> * scale, by + <span class="number">10</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenUZS(bx + <span class="number">7</span> * scale, by + <span class="number">6</span> * scale, <span class="number">6</span> * scale, <span class="number">2</span>, -<span class="number">4.4</span>, <span class="number">1</span>);</span><br><span class="line">    drawTo(bx + <span class="number">11</span> * scale, by + <span class="number">20</span> * scale);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">    drawTo(bx + <span class="number">2</span> * scale, by + <span class="number">20</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    drawTo(bx + <span class="number">12</span> * scale, by + <span class="number">20</span> * scale);</span><br><span class="line">    drawTo(bx + <span class="number">2</span> * scale, by + <span class="number">0</span>);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">    drawTo(bx + <span class="number">5</span> * scale, by + <span class="number">10</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenUZS(bx + <span class="number">5</span> * scale, by + <span class="number">15</span> * scale, <span class="number">5</span> * scale, <span class="number">4.7</span>, -<span class="number">1.6</span>, <span class="number">1</span>);</span><br><span class="line">    bogenGZS(bx + <span class="number">5</span> * scale, by + <span class="number">5</span> * scale, <span class="number">5</span> * scale, -<span class="number">4.7</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">    drawTo(bx + <span class="number">9</span> * scale, by + <span class="number">11</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenUZS(bx + <span class="number">7</span> * scale, by + <span class="number">15</span> * scale, <span class="number">5</span> * scale, <span class="number">4</span>, -<span class="number">0.5</span>, <span class="number">1</span>);</span><br><span class="line">    drawTo(bx + <span class="number">5</span> * scale, by + <span class="number">0</span>);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="number">111</span>:</span><br><span class="line"></span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    drawTo(rubberx, rubbery);</span><br><span class="line">    drawTo(<span class="number">58</span>, <span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">    drawTo(<span class="number">58</span>, <span class="number">45</span>); </span><br><span class="line">    drawTo(<span class="number">0</span>, <span class="number">45</span>);</span><br><span class="line">    drawTo(<span class="number">0</span>, <span class="number">41</span>);</span><br><span class="line">    drawTo(<span class="number">58</span>, <span class="number">41</span>);</span><br><span class="line">    drawTo(<span class="number">60</span>, <span class="number">37</span>);</span><br><span class="line"></span><br><span class="line">    drawTo(<span class="number">0</span>, <span class="number">37</span>);</span><br><span class="line">    drawTo(<span class="number">0</span>, <span class="number">33</span>);</span><br><span class="line">    drawTo(<span class="number">60</span>, <span class="number">33</span>);</span><br><span class="line">    drawTo(<span class="number">60</span>, <span class="number">29</span>);</span><br><span class="line"></span><br><span class="line">    drawTo(<span class="number">0</span>, <span class="number">29</span>);</span><br><span class="line">    drawTo(<span class="number">0</span>, <span class="number">25</span>);</span><br><span class="line">    drawTo(<span class="number">60</span>, <span class="number">25</span>);</span><br><span class="line">    drawTo(<span class="number">60</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    drawTo(<span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    drawTo(<span class="number">60</span>, rubbery-<span class="number">3</span>);</span><br><span class="line">    drawTo(rubberx+<span class="number">6</span> , rubbery-<span class="number">3</span>);</span><br><span class="line">    lift(<span class="number">2</span>);</span><br><span class="line">    drawTo(rubberx , rubbery);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">    drawTo(bx + <span class="number">5</span> * scale, by + <span class="number">15</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenGZS(bx + <span class="number">5</span> * scale, by + <span class="number">15</span> * scale, <span class="number">0.1</span> * scale, <span class="number">1</span>, -<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    drawTo(bx + <span class="number">5</span> * scale, by + <span class="number">5</span> * scale);</span><br><span class="line">    lift(<span class="number">0</span>);</span><br><span class="line">    bogenGZS(bx + <span class="number">5</span> * scale, by + <span class="number">5</span> * scale, <span class="number">0.1</span> * scale, <span class="number">1</span>, -<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    lift(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//抬函数，不同的摆臂高度</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lift</span><span class="params">(<span class="keyword">char</span> lift)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (lift) &#123;</span><br><span class="line">    <span class="comment">// room to optimize  !</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">0</span>: </span><br><span class="line">      <span class="keyword">if</span> (servoLift &gt;= LIFT0) &#123;</span><br><span class="line">      <span class="keyword">while</span> (servoLift &gt;= LIFT0) </span><br><span class="line">      &#123;</span><br><span class="line">        servoLift--;</span><br><span class="line">        servo1.writeMicroseconds(servoLift);				</span><br><span class="line">        delayMicroseconds(LIFTSPEED);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (servoLift &lt;= LIFT0) &#123;</span><br><span class="line">        servoLift++;</span><br><span class="line">        servo1.writeMicroseconds(servoLift);</span><br><span class="line">        delayMicroseconds(LIFTSPEED);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">    <span class="keyword">if</span> (servoLift &gt;= LIFT1) &#123;</span><br><span class="line">      <span class="keyword">while</span> (servoLift &gt;= LIFT1) &#123;</span><br><span class="line">        servoLift--;</span><br><span class="line">        servo1.writeMicroseconds(servoLift);</span><br><span class="line">        delayMicroseconds(LIFTSPEED);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (servoLift &lt;= LIFT1) &#123;</span><br><span class="line">        servoLift++;</span><br><span class="line">        servo1.writeMicroseconds(servoLift);</span><br><span class="line">        delayMicroseconds(LIFTSPEED);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">if</span> (servoLift &gt;= LIFT2) &#123;</span><br><span class="line">      <span class="keyword">while</span> (servoLift &gt;= LIFT2) &#123;</span><br><span class="line">        servoLift--;</span><br><span class="line">        servo1.writeMicroseconds(servoLift);</span><br><span class="line">        delayMicroseconds(LIFTSPEED);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (servoLift &lt;= LIFT2) &#123;</span><br><span class="line">        servoLift++;</span><br><span class="line">        servo1.writeMicroseconds(servoLift);				</span><br><span class="line">        delayMicroseconds(LIFTSPEED);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//里面似乎有勾股定理？</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bogenUZS</span><span class="params">(<span class="keyword">float</span> bx, <span class="keyword">float</span> by, <span class="keyword">float</span> radius, <span class="keyword">int</span> start, <span class="keyword">int</span> ende, <span class="keyword">float</span> sqee)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">float</span> inkr = -<span class="number">0.05</span>;</span><br><span class="line">  <span class="keyword">float</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    drawTo(sqee * radius * cos(start + count) + bx,</span><br><span class="line">    radius * sin(start + count) + by);</span><br><span class="line">    count += inkr;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">while</span> ((start + count) &gt; ende);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//cos？sin？</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bogenGZS</span><span class="params">(<span class="keyword">float</span> bx, <span class="keyword">float</span> by, <span class="keyword">float</span> radius, <span class="keyword">int</span> start, <span class="keyword">int</span> ende, <span class="keyword">float</span> sqee)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">float</span> inkr = <span class="number">0.05</span>;</span><br><span class="line">  <span class="keyword">float</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    drawTo(sqee * radius * cos(start + count) + bx,</span><br><span class="line">    radius * sin(start + count) + by);</span><br><span class="line">    count += inkr;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">while</span> ((start + count) &lt;= ende);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawTo</span><span class="params">(<span class="keyword">double</span> pX, <span class="keyword">double</span> pY)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">double</span> dx, dy, c;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// dx dy of new point</span></span><br><span class="line">  dx = pX - lastX;</span><br><span class="line">  dy = pY - lastY;</span><br><span class="line">  <span class="comment">//path lenght in mm, times 4 equals 4 steps per mm</span></span><br><span class="line">  c = floor(<span class="number">4</span> * sqrt(dx * dx + dy * dy));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (c &lt; <span class="number">1</span>) c = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= c; i++) &#123;</span><br><span class="line">    <span class="comment">// draw line point by point</span></span><br><span class="line">    set_XY(lastX + (i * dx / c), lastY + (i * dy / c));</span><br><span class="line">  &#125;</span><br><span class="line">  lastX = pX;</span><br><span class="line">  lastY = pY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">return_angle</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b, <span class="keyword">double</span> c)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// cosine rule for angle between c and a</span></span><br><span class="line">  <span class="keyword">return</span> acos((a * a + c * c - b * b) / (<span class="number">2</span> * a * c));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用各种三角函数把位置坐标换算成舵机的角度，具体咋算的，请参考</span></span><br><span class="line"><span class="comment">//Plotclock by joo - Thingiverse</span></span><br><span class="line"><span class="comment">//http://www.thingiverse.com/thing:248009/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_XY</span><span class="params">(<span class="keyword">double</span> Tx, <span class="keyword">double</span> Ty)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  delay(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">double</span> dx, dy, c, a1, a2, Hx, Hy;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// calculate triangle between pen, servoLeft and arm joint</span></span><br><span class="line">  <span class="comment">// cartesian dx/dy</span></span><br><span class="line">  dx = Tx - O1X;</span><br><span class="line">  dy = Ty - O1Y;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// polar lemgth (c) and angle (a1)</span></span><br><span class="line">  c = sqrt(dx * dx + dy * dy); <span class="comment">// </span></span><br><span class="line">  a1 = atan2(dy, dx); <span class="comment">//</span></span><br><span class="line">  a2 = return_angle(L1, L2, c);</span><br><span class="line"></span><br><span class="line">    servo2.writeMicroseconds(floor(((a2 + a1 - M_PI) * SERVOFAKTORLEFT) + SERVOLEFTNULL));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// calculate joinr arm point for triangle of the right servo arm</span></span><br><span class="line">  a2 = return_angle(L2, L1, c);</span><br><span class="line">  Hx = Tx + L3 * cos((a1 - a2 + <span class="number">0.621</span>) + M_PI); <span class="comment">//36,5掳</span></span><br><span class="line">  Hy = Ty + L3 * sin((a1 - a2 + <span class="number">0.621</span>) + M_PI);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// calculate triangle between pen joint, servoRight and arm joint</span></span><br><span class="line">  dx = Hx - O2X;</span><br><span class="line">  dy = Hy - O2Y;</span><br><span class="line"></span><br><span class="line">  c = sqrt(dx * dx + dy * dy);</span><br><span class="line">  a1 = atan2(dy, dx);</span><br><span class="line">  a2 = return_angle(L1, (L2 - L3), c);</span><br><span class="line">  servo3.writeMicroseconds(floor(((a1 - a2) * SERVOFAKTORRIGHT) + SERVORIGHTNULL));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Its principle is :</p>
<ul>
<li>marking all the coordinate of each strokes of each number</li>
<li>use the particular digital library</li>
<li>output by moving the mechanical arm</li>
</ul>
<h3 id="Final-product"><a href="#Final-product" class="headerlink" title="Final product"></a>Final product</h3><p><img src="https://s1.ax1x.com/2020/08/29/d7vyb6.jpg" alt="d7vyb6.jpg"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/08/20/ARDUINO-Programme-4/" rel="next" title="ARDUINO Programme 4">
                <i class="fa fa-chevron-left"></i> ARDUINO Programme 4
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/09/06/Finance-Introducing-PPT/" rel="prev" title=" Finance Introducing PPT">
                 Finance Introducing PPT <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/upload/avatar.png"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">60</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#First-class"><span class="nav-number">1.</span> <span class="nav-text">First class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Second-class"><span class="nav-number">2.</span> <span class="nav-text">Second class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Final-product"><span class="nav-number">3.</span> <span class="nav-text">Final product</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Han</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
